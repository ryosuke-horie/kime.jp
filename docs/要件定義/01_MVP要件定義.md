# 管理者用機能要件定義書

---

## 目次
1. 概要
2. 管理者区分と権限
3. 機能詳細要件
   1. 認証・認可
   2. ダッシュボード
   3. 予約管理
   4. 会員管理
   5. タイムテーブル管理
   6. 通知管理
   7. レポート・分析
   8. システム設定
4. 非機能要件
5. 実装優先度

---

## 1. 概要

### 1.1 管理者とは
- アプリケーション自体の管理運用責任者である。（開発者が兼任する）
- 顧客と契約したのち、顧客（ジム）のオーナーアカウント発行を行う。

### 1.2 ユーザー区分
| 区分 | 役割 | アクセス範囲 |
|------|------|-------------|
| システム管理者 | アカウント発行 | 専用のUI。Cloudflare Accessでネットワークレベルで遮断する |
| ジム管理者 | ジムオーナーやマネージャー | 会員データ管理、レポート閲覧、設定変更 |
| スタッフ | トレーナーやフロントスタッフ | 予約確認・登録、会員情報閲覧 |

---

## 2. 管理者区分と権限

### 2.1 権限マトリックス
| 機能 | システム管理者 | ジム管理者 | スタッフ |
|------|--------------|-----------|---------|
| **認証・認可** |
| 管理者アカウント作成 | ✅ | ❌ | ❌ |
| 権限設定 | ✅ | ⚠️(ジム内に閉じる) | ❌ |
| **ダッシュボード** |
| KPI閲覧 | ✅ | ❌ | ❌ |
| システム状態監視 | ✅ | ❌ | ❌ |
| **予約管理** |
| 予約一覧閲覧 | ❌ | ✅ | ✅ |
| 予約作成・編集 | ❌ | ✅ | ✅ |
| 予約キャンセル | ❌ | ✅ | ✅ |
| **会員管理** |
| 会員一覧閲覧 | ❌ | ✅ | ✅ |
| 会員情報編集 | ❌ | ✅ | ✅ |
| 会員追加・削除 | ❌ | ✅ | ✅ |
| **タイムテーブル管理** |
| タイムテーブル閲覧 | ❌ | ✅ | ✅ |
| クラス追加・編集 | ❌ | ✅ | ✅ |
| 講師割り当て | ❌ | ✅ | ✅ |
| **通知管理** |
| 通知テンプレート設定 | ❌ | ✅ | ✅ |
| 通知履歴閲覧 | ❌ | ✅ | ✅ |
| 手動通知送信 | ❌ | ✅ | ✅ |
| **レポート・分析** |
| 基本レポート閲覧 | ✅ | ✅ | ❌ |
| 詳細分析 | ✅ | ✅ | ❌ |
| データエクスポート | ✅ | ✅ | ❌ |
| **システム設定** |
| 基本設定変更 | ✅ | ✅ | ❌ |
| バックアップ/復元 | ✅ | ❌ | ❌ |

---

## 3. 機能詳細要件

### 3.1 認証・認可
| No | 要件ID | 概要 | 詳細 |
|----|--------|------|------|
| 1 | AUTH-01 | 管理者ログイン | Cloudflare Access 使用してアクセス制限 |
| 2 | AUTH-02 | 権限管理 | 「システム管理者」「ジム管理者」「スタッフ」の3階層の権限設定 |
| 3 | AUTH-03 | セッション管理 | 72時間の有効期限付きセッション |
| 4 | AUTH-04 | アクセスログ | 管理画面へのログイン/操作ログを記録し、不正アクセス検知 |

### 3.2 ダッシュボード
| No | 要件ID | 概要 | 詳細 |
|----|--------|------|------|
| 1 | DASH-01 | KPI表示 | 当日予約数、会員数、売上などの主要指標をカード形式で表示 |
| 2 | DASH-02 | 最近の予約 | 当日および翌日の予約一覧をタイムライン形式で表示 |
| 3 | DASH-03 | クイックアクセス | 頻繁に使用する機能へのショートカットボタンを配置 |
| 4 | DASH-04 | 通知エリア | システムからの重要通知や未読メッセージを表示 |

### 3.3 予約管理
| No | 要件ID | 概要 | 詳細 |
|----|--------|------|------|
| 1 | RESV-01 | 予約一覧表示 | 日付・時間・会員・クラス別に予約をフィルタリング表示 |
| 2 | RESV-02 | 予約詳細 | 個別予約の詳細情報と履歴を表示、編集機能を提供 |
| 3 | RESV-03 | 新規予約登録 | スタッフが会員に代わって予約を登録する機能 |
| 4 | RESV-04 | 予約ステータス変更 | 「予約済み」「来店済み」「キャンセル」などのステータス管理 |
| 5 | RESV-05 | キャンセル管理 | キャンセルポリシーの適用と料金計算、再予約促進 |

### 3.4 会員管理
| No | 要件ID | 概要 | 詳細 |
|----|--------|------|------|
| 1 | MEMB-01 | 会員一覧表示 | 名前・会員種別・状態でフィルタリング・検索が可能 |
| 2 | MEMB-02 | 会員詳細情報 | 個人情報、契約情報、予約履歴、決済履歴などを統合表示 |
| 3 | MEMB-03 | 会員登録・編集 | 新規会員の登録と既存会員情報の編集機能 |
| 4 | MEMB-04 | メモ機能 | 会員ごとのスタッフメモ（内部用）の記録・共有 |

### 3.5 タイムテーブル管理
| No | 要件ID | 概要 | 詳細 |
|----|--------|------|------|
| 1 | TIME-01 | カレンダー表示 | 日/週/月表示切替可能なカレンダーインターフェース |
| 2 | TIME-02 | クラス設定 | クラス名、種別、定員、所要時間などの基本設定 |
| 3 | TIME-03 | 定期クラス登録 | 毎週特定曜日・時間に開催される定期クラスの登録 |
| 5 | TIME-05 | 講師割り当て | クラスごとの講師アサイン機能、講師のシフト管理 |
| 6 | TIME-06 | 休館日設定 | 店休日、祝日、メンテナンス日の設定とカレンダー反映 |
| 7 | TIME-07 | テンプレート保存 | よく使うタイムテーブルパターンをテンプレートとして保存 |

### 3.6 通知管理
| No | 要件ID | 概要 | 詳細 |
|----|--------|------|------|
| 1 | NOTF-01 | 通知テンプレート | LINE/SMS/Emailの各チャネル用テンプレート管理 |
| 2 | NOTF-02 | 自動通知設定 | 予約確認、リマインダー、フォローアップなどの自動通知設定 |
| 3 | NOTF-03 | 一斉送信 | 特定条件の会員グループに対するメッセージ一斉送信 |
| 4 | NOTF-04 | 送信履歴 | 通知の送信履歴、開封率、クリック率の確認 |
| 5 | NOTF-05 | AI文章生成 | フォローアップメッセージの自動生成と編集 |
| 6 | NOTF-06 | スケジュール送信 | 日時指定での通知予約送信機能 |

### 3.7 レポート・分析
| No | 要件ID | 概要 | 詳細 |
|----|--------|------|------|
| 1 | REPO-01 | 予約統計 | 日次/週次/月次の予約数推移、キャンセル率などの統計 |
| 2 | REPO-02 | 会員分析 | 会員数推移、活動率、退会率などの分析 |
| 3 | REPO-03 | クラス分析 | クラス別の人気度、稼働率、リピート率の分析 |
| 4 | REPO-04 | 自動レポート | 指定した頻度で管理者へ自動送信されるレポート機能 |

### 3.8 システム設定
| No | 要件ID | 概要 | 詳細 |
|----|--------|------|------|
| 1 | CONF-01 | 基本情報設定 | ジム名、住所、営業時間、連絡先などの基本情報設定 |
| 2 | CONF-02 | 予約ポリシー設定 | 予約可能日時範囲、キャンセルポリシー |
| 4 | CONF-04 | 通知設定 | 自動通知のタイミングと内容設定、送信チャネル設定 |

---

## 4. 非機能要件

### 4.1 セキュリティ
| 区分 | 要件 | 詳細 |
|------|------|------|
| アクセス制御 | Cloudflare Access | システム管理画面へのアクセスはCloudflare Accessによる認証を必須とする |
| ジムオーナー/スタッフログイン | jwt, d1 | jwtを利用してログイン検証を行う。 |
| データ保護 | 個人情報暗号化 | 会員の個人情報（メール、電話番号など）はD1で暗号化列として保存。 |
| セッション管理 | 自動ログアウト | 30分間操作がない場合に自動ログアウト |
| 個人情報保護法等への対応 | ジム・体験者双方に確認をとりD1に保存 | 予約時に必須とする |

### 4.2 パフォーマンス
| 区分 | 指標 | 目標値 |
|------|------|--------|
| 応答時間 | API P95応答時間 | 300ms以下 |
| ページ表示 | 管理画面初期表示 | 1.5秒以下 |
| 一覧表示 | 1000件データの一覧表示 | 2秒以下 |