# システム管理者向けジム管理機能要件定義

## 概要
システム管理者が新規ジムの登録、既存ジムの参照・編集・削除を行うための機能群です。システム管理者はウェブインターフェースを通じて、ジム情報とジムオーナー情報（スタッフとして管理）を一括で管理できます。

## 機能要件

### 1. ジム一覧表示機能
- ジム一覧画面へのアクセスパス: `/admin/gyms`
- システム内の全ジム情報を一覧表示する
- 表示項目:
  - ジムID
  - ジム名
  - オーナーメールアドレス
  - 登録日時
  - アクション（編集・削除ボタン）
- ソート機能: 各カラムでソート可能
- 検索・フィルター機能:
  - ジム名検索
  - オーナーメールアドレス検索
- ページネーション: 一度に表示する件数を調整可能（デフォルト20件）

### 2. ジム登録機能
- 登録画面へのアクセスパス: `/admin/gyms/create`
- ジム一覧画面から「新規ジム登録」ボタンで遷移
- 入力項目:
  - ジム情報:
    - ジム名（必須）
    - オーナーメールアドレス（必須）
    - プラン（任意、デフォルト「basic」）
    - タイムゾーン（任意、デフォルト「Asia/Tokyo」）
  - オーナー情報（staffテーブルに「gym_admin」ロールで保存）:
    - 氏名（必須）
    - メールアドレス（必須、ジムのオーナーメールアドレスと同じ）
    - アクティブステータス（デフォルトは有効:1）
- バリデーション:
  - 必須項目の入力チェック
  - メールアドレスの重複チェック
  - メールアドレス形式チェック
- 登録完了時:
  - 成功メッセージ表示
  - オーナーへの招待メール自動送信
  - ジム一覧画面に戻るリンク表示

### 3. ジム詳細表示・編集機能
- 詳細/編集画面へのアクセスパス: `/admin/gyms/{gymId}/edit`
- ジム一覧画面の各ジムの「編集」ボタンから遷移
- ジム情報の表示・編集が可能
- 編集項目:
  - ジム名
  - オーナーメールアドレス（変更時は確認ダイアログ表示）
  - プラン
  - タイムゾーン
- 保存時のバリデーション:
  - 必須項目の入力チェック
  - メールアドレスの重複チェック
- 保存成功時:
  - 成功メッセージ表示
  - 必要に応じてオーナーに通知メール送信

### 4. ジム削除機能
- ジム一覧画面の各ジムの「削除」ボタンから実行
- 削除前に確認ダイアログを表示
  - 削除の影響（予約データ、スタッフアカウント等への影響）を表示
- 削除操作:
  - DBからのジムの物理削除（関連するスタッフ、クラス、予約等も削除）
  - 代替案：論理削除の仕組みを新たに追加実装
- 削除成功時:
  - 成功メッセージ表示
  - オーナーに通知メール送信

### 5. スタッフ管理機能（ジム情報に付随）
- ジム詳細画面内でスタッフ一覧を表示
- スタッフの追加・削除が可能
- スタッフ情報:
  - 氏名
  - メールアドレス
  - 役割（system_admin/gym_admin/staff）
  - アクティブステータス（1:有効/0:無効）
- スタッフ追加時:
  - 招待メール自動送信

## 非機能要件

### 1. セキュリティ
- システム管理者のみアクセス可能
- 変更操作のログを記録

### 2. パフォーマンス
- ジム一覧画面の初期表示は1秒以内
- 大量データ（1000件以上）の場合もページネーションでスムーズに動作

### 3. ユーザビリティ
- レスポンシブデザイン（モバイル対応）
- 必須項目は視覚的に明示
- エラーメッセージは日本語で具体的に表示

## 画面遷移フロー
1. 管理者ダッシュボード（`/admin/dashboard`）
2. → ジム一覧画面（`/admin/gyms`）
3. → ジム登録画面（`/admin/gyms/create`）または編集画面（`/admin/gyms/{gymId}/edit`）
4. → 登録/更新完了後、ジム一覧画面に戻る

## データモデル概要（既存DB設計に準拠）
```sql
-- gymsテーブル
CREATE TABLE IF NOT EXISTS gyms (
  gym_id        TEXT PRIMARY KEY,
  name          TEXT NOT NULL,
  owner_email   TEXT NOT NULL,
  created_at    TEXT DEFAULT CURRENT_TIMESTAMP,
  updated_at    TEXT DEFAULT CURRENT_TIMESTAMP
);

-- staffテーブル（オーナーもこのテーブルで管理）
CREATE TABLE IF NOT EXISTS staff (
  staff_id     TEXT PRIMARY KEY,
  gym_id       TEXT NOT NULL,
  name         TEXT NOT NULL,
  email        TEXT,
  role         TEXT NOT NULL
                 CHECK (role IN ('system_admin','gym_admin','staff'))
                 DEFAULT 'staff',
  active       INTEGER NOT NULL DEFAULT 1,
  created_at   TEXT DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (gym_id) REFERENCES gyms(gym_id)
);
```

## 実装優先度
1. ジム一覧表示機能
2. ジム登録機能
3. ジム詳細表示・編集機能
4. ジム削除機能
5. スタッフ管理機能

## 技術的考慮事項
- フォームバリデーションにZodを使用（型安全性確保）
- React Hook Formを使用したフォーム管理
- shadcn/uiのフォームコンポーネントを活用