# lefthook.yml

# pre-commitフック設定
pre-commit:
  parallel: true
  commands:
    biome-check:
      skip_empty: true
      run: |
        STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACMR | grep -E '\.(js|jsx|ts|tsx)$' || true)
        if [ -n "$STAGED_FILES" ]; then
          echo "📝 コミット前の検証を実行中..."
          echo "🔍 Biomeによるコードチェックを実行中..."
          echo "$STAGED_FILES" | xargs pnpm biome check --write
        else
          echo "🔍 チェック対象のファイルがありません。スキップします。"
        fi
        exit 0
    biome-lint:
      skip_empty: true
      run: |
        STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACMR | grep -E '\.(js|jsx|ts|tsx)$' || true)
        if [ -n "$STAGED_FILES" ]; then
          echo "🔍 Biomeによるリントを実行中..."
          echo "$STAGED_FILES" | xargs pnpm biome lint --write
        else
          echo "🔍 リント対象のファイルがありません。スキップします。"
        fi
        exit 0

# pre-pushフック設定
pre-push:
  parallel: false
  commands:
    typecheck:
      run: |
        echo "🧪 プッシュ前の検証を実行中..."
        echo "🔍 TypeScriptの型チェックを実行中..."
        pnpm typecheck
    lint:
      run: |
        echo "🔍 リントチェックを実行中..."
        pnpm lint
    build:
      run: |
        echo "🔨 ビルド検証を実行中..."
        pnpm build
    test:
      run: |
        echo "🧪 テストを実行中..."
        pnpm test